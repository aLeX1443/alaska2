FROM pytorch/pytorch:1.5-cuda10.1-cudnn7-devel

WORKDIR /alaska2/

ENV TZ=Europe/London
ENV DEBIAN_FRONTEND=noninteractive

RUN apt -y update \
    && apt install build-essential checkinstall -y \
    && apt -y install libreadline-gplv2-dev libncursesw5-dev libssl-dev \
        libsqlite3-dev tk-dev libgdbm-dev libc6-dev libbz2-dev libffi-dev \
        zlib1g-dev libsm6 libxext6 libxrender-dev wget git \
    && apt -y clean \
    && apt -y autoremove \
    && rm -rf /var/lib/apt/lists/*

RUN pip install --upgrade pip
RUN pip install opencv-python
RUN pip install pandas trimesh boto3 tqdm pillow scipy scikit-learn \
    click albumentations efficientnet_pytorch tensorboardX catalyst \
    cython pytest

RUN git clone https://github.com/dwgoon/jpegio
RUN pip install jpegio/.

ENV NVIDIA_VISIBLE_DEVICES all
ENV NVIDIA_DRIVER_CAPABILITIES compute,utility
